/**
 * MCP Bridge
 * Communicates with Z.ai Vision MCP server for cross-platform tool access
 */
import { Client } from '@modelcontextprotocol/sdk';
export class MCPBridge {
    client;
    serverPath;
    timeout;
    constructor(options) {
        this.serverPath = options.serverPath;
        this.timeout = options.timeout || 30000;
    }
    /**
     * Connect to MCP server
     */
    async connect() {
        if (this.client) {
            return; // Already connected
        }
        this.client = new Client({
            name: 'zai-vision-bridge',
            version: '1.0.0',
        }, {
            stdio: {
                command: this.serverPath,
                env: {
                    MCP_SERVER_TIMEOUT: this.timeout.toString(),
                }
            }
        });
        // Wait for connection
        await new Promise((resolve) => setTimeout(resolve, 1000));
    }
    /**
     * Call analyze_image tool
     */
    async analyzeImage(imagePath, options = {}) {
        await this.connect();
        const result = await this.client.callTool({
            name: 'analyze_image',
            arguments: {
                image: imagePath,
                detail: options.detail || 'medium',
                detect_objects: options.detectObjects !== false,
            }
        });
        return JSON.parse(result.content[0].text);
    }
    /**
     * Call extract_text tool
     */
    async extractText(imagePath, options = {}) {
        await this.connect();
        const result = await this.client.callTool({
            name: 'extract_text',
            arguments: {
                image: imagePath,
                preserve_format: options.preserveFormat !== false,
                language: options.language || 'auto',
            }
        });
        return result.content[0].text;
    }
    /**
     * Call vision_search tool
     */
    async visionSearch(imagePath, options = {}) {
        await this.connect();
        const result = await this.client.callTool({
            name: 'vision_search',
            arguments: {
                image: imagePath,
                search_type: options.searchType || 'web',
                max_results: options.maxResults || 5,
            }
        });
        return result.content[0].text;
    }
    /**
     * Call vision_web_search tool
     */
    async visionWebSearch(imagePath, options = {}) {
        await this.connect();
        const result = await this.client.callTool({
            name: 'vision_web_search',
            arguments: {
                image: imagePath,
                query_type: options.queryType || 'information',
                max_results: options.maxResults || 5,
            }
        });
        return result.content[0].text;
    }
    /**
     * Disconnect from MCP server
     */
    async disconnect() {
        if (this.client) {
            await this.client.close();
            this.client = null;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWNwLWJyaWRnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaGFyZWQvbWNwLWJyaWRnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFRbkQsTUFBTSxPQUFPLFNBQVM7SUFDWixNQUFNLENBQWdCO0lBQ3RCLFVBQVUsQ0FBUztJQUNuQixPQUFPLENBQVM7SUFFeEIsWUFBWSxPQUF5QjtRQUNuQyxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDckMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxJQUFJLEtBQUssQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsT0FBTztRQUNYLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hCLE9BQU8sQ0FBQyxvQkFBb0I7UUFDOUIsQ0FBQztRQUVELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUM7WUFDdkIsSUFBSSxFQUFFLG1CQUFtQjtZQUN6QixPQUFPLEVBQUUsT0FBTztTQUNqQixFQUFFO1lBQ0QsS0FBSyxFQUFFO2dCQUNMLE9BQU8sRUFBRSxJQUFJLENBQUMsVUFBVTtnQkFDeEIsR0FBRyxFQUFFO29CQUNILGtCQUFrQixFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFO2lCQUM1QzthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsc0JBQXNCO1FBQ3RCLE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsWUFBWSxDQUNoQixTQUFpQixFQUNqQixVQUE0QixFQUFFO1FBRTlCLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXJCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDeEMsSUFBSSxFQUFFLGVBQWU7WUFDckIsU0FBUyxFQUFFO2dCQUNULEtBQUssRUFBRSxTQUFTO2dCQUNoQixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sSUFBSSxRQUFRO2dCQUNsQyxjQUFjLEVBQUUsT0FBTyxDQUFDLGFBQWEsS0FBSyxLQUFLO2FBQ2hEO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLFdBQVcsQ0FDZixTQUFpQixFQUNqQixVQUE0QixFQUFFO1FBRTlCLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXJCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDeEMsSUFBSSxFQUFFLGNBQWM7WUFDcEIsU0FBUyxFQUFFO2dCQUNULEtBQUssRUFBRSxTQUFTO2dCQUNoQixlQUFlLEVBQUUsT0FBTyxDQUFDLGNBQWMsS0FBSyxLQUFLO2dCQUNqRCxRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxNQUFNO2FBQ3JDO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsWUFBWSxDQUNoQixTQUFpQixFQUNqQixVQUE0QixFQUFFO1FBRTlCLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXJCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDeEMsSUFBSSxFQUFFLGVBQWU7WUFDckIsU0FBUyxFQUFFO2dCQUNULEtBQUssRUFBRSxTQUFTO2dCQUNoQixXQUFXLEVBQUUsT0FBTyxDQUFDLFVBQVUsSUFBSSxLQUFLO2dCQUN4QyxXQUFXLEVBQUUsT0FBTyxDQUFDLFVBQVUsSUFBSSxDQUFDO2FBQ3JDO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNoQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsZUFBZSxDQUNuQixTQUFpQixFQUNqQixVQUE0QixFQUFFO1FBRTlCLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXJCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDeEMsSUFBSSxFQUFFLG1CQUFtQjtZQUN6QixTQUFTLEVBQUU7Z0JBQ1QsS0FBSyxFQUFFLFNBQVM7Z0JBQ2hCLFVBQVUsRUFBRSxPQUFPLENBQUMsU0FBUyxJQUFJLGFBQWE7Z0JBQzlDLFdBQVcsRUFBRSxPQUFPLENBQUMsVUFBVSxJQUFJLENBQUM7YUFDckM7U0FDRixDQUFDLENBQUM7UUFFSCxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxVQUFVO1FBQ2QsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDaEIsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLENBQUM7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCBCcmlkZ2VcbiAqIENvbW11bmljYXRlcyB3aXRoIFouYWkgVmlzaW9uIE1DUCBzZXJ2ZXIgZm9yIGNyb3NzLXBsYXRmb3JtIHRvb2wgYWNjZXNzXG4gKi9cblxuaW1wb3J0IHsgQ2xpZW50IH0gZnJvbSAnQG1vZGVsY29udGV4dHByb3RvY29sL3Nkayc7XG5pbXBvcnQgeyBaYWlWaXNpb25DbGllbnQsIFphaUFuYWx5c2lzUmVzdWx0IH0gZnJvbSAnLi92aXNpb24tY2xpZW50JztcblxuZXhwb3J0IGludGVyZmFjZSBNQ1BCcmlkZ2VPcHRpb25zIHtcbiAgc2VydmVyUGF0aDogc3RyaW5nO1xuICB0aW1lb3V0PzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgTUNQQnJpZGdlIHtcbiAgcHJpdmF0ZSBjbGllbnQ6IENsaWVudCB8IG51bGw7XG4gIHByaXZhdGUgc2VydmVyUGF0aDogc3RyaW5nO1xuICBwcml2YXRlIHRpbWVvdXQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBNQ1BCcmlkZ2VPcHRpb25zKSB7XG4gICAgdGhpcy5zZXJ2ZXJQYXRoID0gb3B0aW9ucy5zZXJ2ZXJQYXRoO1xuICAgIHRoaXMudGltZW91dCA9IG9wdGlvbnMudGltZW91dCB8fCAzMDAwMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25uZWN0IHRvIE1DUCBzZXJ2ZXJcbiAgICovXG4gIGFzeW5jIGNvbm5lY3QoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuY2xpZW50KSB7XG4gICAgICByZXR1cm47IC8vIEFscmVhZHkgY29ubmVjdGVkXG4gICAgfVxuXG4gICAgdGhpcy5jbGllbnQgPSBuZXcgQ2xpZW50KHtcbiAgICAgIG5hbWU6ICd6YWktdmlzaW9uLWJyaWRnZScsXG4gICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxuICAgIH0sIHtcbiAgICAgIHN0ZGlvOiB7XG4gICAgICAgIGNvbW1hbmQ6IHRoaXMuc2VydmVyUGF0aCxcbiAgICAgICAgZW52OiB7XG4gICAgICAgICAgTUNQX1NFUlZFUl9USU1FT1VUOiB0aGlzLnRpbWVvdXQudG9TdHJpbmcoKSxcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gV2FpdCBmb3IgY29ubmVjdGlvblxuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIGFuYWx5emVfaW1hZ2UgdG9vbFxuICAgKi9cbiAgYXN5bmMgYW5hbHl6ZUltYWdlKFxuICAgIGltYWdlUGF0aDogc3RyaW5nLFxuICAgIG9wdGlvbnM6IFphaVZpc2lvbk9wdGlvbnMgPSB7fVxuICApOiBQcm9taXNlPFphaUFuYWx5c2lzUmVzdWx0PiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNsaWVudC5jYWxsVG9vbCh7XG4gICAgICBuYW1lOiAnYW5hbHl6ZV9pbWFnZScsXG4gICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgaW1hZ2U6IGltYWdlUGF0aCxcbiAgICAgICAgZGV0YWlsOiBvcHRpb25zLmRldGFpbCB8fCAnbWVkaXVtJyxcbiAgICAgICAgZGV0ZWN0X29iamVjdHM6IG9wdGlvbnMuZGV0ZWN0T2JqZWN0cyAhPT0gZmFsc2UsXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gSlNPTi5wYXJzZShyZXN1bHQuY29udGVudFswXS50ZXh0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsIGV4dHJhY3RfdGV4dCB0b29sXG4gICAqL1xuICBhc3luYyBleHRyYWN0VGV4dChcbiAgICBpbWFnZVBhdGg6IHN0cmluZyxcbiAgICBvcHRpb25zOiBaYWlWaXNpb25PcHRpb25zID0ge31cbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBhd2FpdCB0aGlzLmNvbm5lY3QoKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2xpZW50LmNhbGxUb29sKHtcbiAgICAgIG5hbWU6ICdleHRyYWN0X3RleHQnLFxuICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgIGltYWdlOiBpbWFnZVBhdGgsXG4gICAgICAgIHByZXNlcnZlX2Zvcm1hdDogb3B0aW9ucy5wcmVzZXJ2ZUZvcm1hdCAhPT0gZmFsc2UsXG4gICAgICAgIGxhbmd1YWdlOiBvcHRpb25zLmxhbmd1YWdlIHx8ICdhdXRvJyxcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQuY29udGVudFswXS50ZXh0O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGwgdmlzaW9uX3NlYXJjaCB0b29sXG4gICAqL1xuICBhc3luYyB2aXNpb25TZWFyY2goXG4gICAgaW1hZ2VQYXRoOiBzdHJpbmcsXG4gICAgb3B0aW9uczogWmFpVmlzaW9uT3B0aW9ucyA9IHt9XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNsaWVudC5jYWxsVG9vbCh7XG4gICAgICBuYW1lOiAndmlzaW9uX3NlYXJjaCcsXG4gICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgaW1hZ2U6IGltYWdlUGF0aCxcbiAgICAgICAgc2VhcmNoX3R5cGU6IG9wdGlvbnMuc2VhcmNoVHlwZSB8fCAnd2ViJyxcbiAgICAgICAgbWF4X3Jlc3VsdHM6IG9wdGlvbnMubWF4UmVzdWx0cyB8fCA1LFxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdC5jb250ZW50WzBdLnRleHQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FsbCB2aXNpb25fd2ViX3NlYXJjaCB0b29sXG4gICAqL1xuICBhc3luYyB2aXNpb25XZWJTZWFyY2goXG4gICAgaW1hZ2VQYXRoOiBzdHJpbmcsXG4gICAgb3B0aW9uczogWmFpVmlzaW9uT3B0aW9ucyA9IHt9XG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0KCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNsaWVudC5jYWxsVG9vbCh7XG4gICAgICBuYW1lOiAndmlzaW9uX3dlYl9zZWFyY2gnLFxuICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgIGltYWdlOiBpbWFnZVBhdGgsXG4gICAgICAgIHF1ZXJ5X3R5cGU6IG9wdGlvbnMucXVlcnlUeXBlIHx8ICdpbmZvcm1hdGlvbicsXG4gICAgICAgIG1heF9yZXN1bHRzOiBvcHRpb25zLm1heFJlc3VsdHMgfHwgNSxcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQuY29udGVudFswXS50ZXh0O1xuICB9XG5cbiAgLyoqXG4gICAqIERpc2Nvbm5lY3QgZnJvbSBNQ1Agc2VydmVyXG4gICAqL1xuICBhc3luYyBkaXNjb25uZWN0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLmNsaWVudCkge1xuICAgICAgYXdhaXQgdGhpcy5jbGllbnQuY2xvc2UoKTtcbiAgICAgIHRoaXMuY2xpZW50ID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==