/**
 * Image encoding utilities for Z.ai Vision Suite
 * Handles conversion of images to formats suitable for API requests
 */
import { readFile, stat } from 'fs/promises';
import { existsSync } from 'fs';
import { extname } from 'path';
/**
 * Supported image mime types
 */
const MIME_TYPES = {
    '.jpg': 'image/jpeg',
    '.jpeg': 'image/jpeg',
    '.png': 'image/png',
    '.gif': 'image/gif',
    '.webp': 'image/webp',
    '.bmp': 'image/bmp',
};
/**
 * Get MIME type from file extension
 */
export function getImageMimeType(path) {
    const ext = extname(path).toLowerCase();
    return MIME_TYPES[ext] || 'image/jpeg';
}
/**
 * Validate that an image file exists and is readable
 */
export function validateImagePath(path) {
    return existsSync(path);
}
/**
 * Encode an image file as a base64 data URL
 */
export async function encodeImageAsBase64(imagePath) {
    if (!validateImagePath(imagePath)) {
        throw new Error(`Image file not found: ${imagePath}`);
    }
    const buffer = await readFile(imagePath);
    const mimeType = getImageMimeType(imagePath);
    const base64 = buffer.toString('base64');
    return `data:${mimeType};base64,${base64}`;
}
/**
 * Encode an image file for multipart upload
 */
export async function encodeImageAsMultipart(imagePath) {
    if (!validateImagePath(imagePath)) {
        throw new Error(`Image file not found: ${imagePath}`);
    }
    const data = await readFile(imagePath);
    const mimeType = getImageMimeType(imagePath);
    const stats = await stat(imagePath);
    return { data, mimeType, size: stats.size };
}
/**
 * Extract base64 data from a data URL
 */
export function extractBase64FromDataUrl(dataUrl) {
    const matches = dataUrl.match(/^data:image\/[a-z]+;base64,(.+)$/);
    return matches ? matches[1] : dataUrl;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5jb2Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaGFyZWQvZW5jb2Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSCxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM3QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ2hDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0I7O0dBRUc7QUFDSCxNQUFNLFVBQVUsR0FBMkI7SUFDekMsTUFBTSxFQUFFLFlBQVk7SUFDcEIsT0FBTyxFQUFFLFlBQVk7SUFDckIsTUFBTSxFQUFFLFdBQVc7SUFDbkIsTUFBTSxFQUFFLFdBQVc7SUFDbkIsT0FBTyxFQUFFLFlBQVk7SUFDckIsTUFBTSxFQUFFLFdBQVc7Q0FDcEIsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGdCQUFnQixDQUFDLElBQVk7SUFDM0MsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3hDLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLFlBQVksQ0FBQztBQUN6QyxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsSUFBWTtJQUM1QyxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMxQixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLENBQUMsS0FBSyxVQUFVLG1CQUFtQixDQUFDLFNBQWlCO0lBQ3pELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELE1BQU0sTUFBTSxHQUFHLE1BQU0sUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3pDLE1BQU0sUUFBUSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDekMsT0FBTyxRQUFRLFFBQVEsV0FBVyxNQUFNLEVBQUUsQ0FBQztBQUM3QyxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLENBQUMsS0FBSyxVQUFVLHNCQUFzQixDQUFDLFNBQWlCO0lBSzVELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELE1BQU0sSUFBSSxHQUFHLE1BQU0sUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRXBDLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDOUMsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLHdCQUF3QixDQUFDLE9BQWU7SUFDdEQsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO0lBQ2xFLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUN4QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbWFnZSBlbmNvZGluZyB1dGlsaXRpZXMgZm9yIFouYWkgVmlzaW9uIFN1aXRlXG4gKiBIYW5kbGVzIGNvbnZlcnNpb24gb2YgaW1hZ2VzIHRvIGZvcm1hdHMgc3VpdGFibGUgZm9yIEFQSSByZXF1ZXN0c1xuICovXG5cbmltcG9ydCB7IHJlYWRGaWxlLCBzdGF0IH0gZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IGV4dG5hbWUgfSBmcm9tICdwYXRoJztcblxuLyoqXG4gKiBTdXBwb3J0ZWQgaW1hZ2UgbWltZSB0eXBlc1xuICovXG5jb25zdCBNSU1FX1RZUEVTOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAnLmpwZyc6ICdpbWFnZS9qcGVnJyxcbiAgJy5qcGVnJzogJ2ltYWdlL2pwZWcnLFxuICAnLnBuZyc6ICdpbWFnZS9wbmcnLFxuICAnLmdpZic6ICdpbWFnZS9naWYnLFxuICAnLndlYnAnOiAnaW1hZ2Uvd2VicCcsXG4gICcuYm1wJzogJ2ltYWdlL2JtcCcsXG59O1xuXG4vKipcbiAqIEdldCBNSU1FIHR5cGUgZnJvbSBmaWxlIGV4dGVuc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW1hZ2VNaW1lVHlwZShwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBleHQgPSBleHRuYW1lKHBhdGgpLnRvTG93ZXJDYXNlKCk7XG4gIHJldHVybiBNSU1FX1RZUEVTW2V4dF0gfHwgJ2ltYWdlL2pwZWcnO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYW4gaW1hZ2UgZmlsZSBleGlzdHMgYW5kIGlzIHJlYWRhYmxlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUltYWdlUGF0aChwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIGV4aXN0c1N5bmMocGF0aCk7XG59XG5cbi8qKlxuICogRW5jb2RlIGFuIGltYWdlIGZpbGUgYXMgYSBiYXNlNjQgZGF0YSBVUkxcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuY29kZUltYWdlQXNCYXNlNjQoaW1hZ2VQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICBpZiAoIXZhbGlkYXRlSW1hZ2VQYXRoKGltYWdlUGF0aCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEltYWdlIGZpbGUgbm90IGZvdW5kOiAke2ltYWdlUGF0aH1gKTtcbiAgfVxuXG4gIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IHJlYWRGaWxlKGltYWdlUGF0aCk7XG4gIGNvbnN0IG1pbWVUeXBlID0gZ2V0SW1hZ2VNaW1lVHlwZShpbWFnZVBhdGgpO1xuICBjb25zdCBiYXNlNjQgPSBidWZmZXIudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICByZXR1cm4gYGRhdGE6JHttaW1lVHlwZX07YmFzZTY0LCR7YmFzZTY0fWA7XG59XG5cbi8qKlxuICogRW5jb2RlIGFuIGltYWdlIGZpbGUgZm9yIG11bHRpcGFydCB1cGxvYWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuY29kZUltYWdlQXNNdWx0aXBhcnQoaW1hZ2VQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgZGF0YTogQnVmZmVyO1xuICBtaW1lVHlwZTogc3RyaW5nO1xuICBzaXplOiBudW1iZXI7XG59PiB7XG4gIGlmICghdmFsaWRhdGVJbWFnZVBhdGgoaW1hZ2VQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgSW1hZ2UgZmlsZSBub3QgZm91bmQ6ICR7aW1hZ2VQYXRofWApO1xuICB9XG5cbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlYWRGaWxlKGltYWdlUGF0aCk7XG4gIGNvbnN0IG1pbWVUeXBlID0gZ2V0SW1hZ2VNaW1lVHlwZShpbWFnZVBhdGgpO1xuICBjb25zdCBzdGF0cyA9IGF3YWl0IHN0YXQoaW1hZ2VQYXRoKTtcblxuICByZXR1cm4geyBkYXRhLCBtaW1lVHlwZSwgc2l6ZTogc3RhdHMuc2l6ZSB9O1xufVxuXG4vKipcbiAqIEV4dHJhY3QgYmFzZTY0IGRhdGEgZnJvbSBhIGRhdGEgVVJMXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0QmFzZTY0RnJvbURhdGFVcmwoZGF0YVVybDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbWF0Y2hlcyA9IGRhdGFVcmwubWF0Y2goL15kYXRhOmltYWdlXFwvW2Etel0rO2Jhc2U2NCwoLispJC8pO1xuICByZXR1cm4gbWF0Y2hlcyA/IG1hdGNoZXNbMV0gOiBkYXRhVXJsO1xufVxuIl19